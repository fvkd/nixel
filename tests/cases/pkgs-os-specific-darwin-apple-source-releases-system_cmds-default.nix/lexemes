{ "{" (1, 1)
ID "stdenv" (1, 3)
, "," (1, 9)
ID "appleDerivation" (1, 11)
, "," (1, 26)
ID "lib" (1, 28)
, "," (2, 1)
ID "libutil" (2, 3)
, "," (2, 10)
ID "Librpcsvc" (2, 12)
, "," (2, 21)
ID "apple_sdk" (2, 23)
, "," (2, 32)
ID "pam" (2, 34)
, "," (2, 37)
ID "CF" (2, 39)
, "," (2, 41)
ID "openbsm" (2, 43)
} "}" (2, 51)
: ":" (2, 52)
ID "appleDerivation" (4, 1)
{ "{" (4, 17)
ID "buildInputs" (10, 3)
= "=" (10, 15)
[ "[" (10, 17)
ID "libutil" (10, 19)
ID "Librpcsvc" (10, 27)
ID "apple_sdk" (10, 37)
. "." (10, 46)
ID "frameworks" (10, 47)
. "." (10, 57)
ID "OpenDirectory" (10, 58)
ID "pam" (10, 72)
ID "CF" (10, 76)
ID "apple_sdk" (11, 19)
. "." (11, 28)
ID "frameworks" (11, 29)
. "." (11, 39)
ID "IOKit" (11, 40)
ID "openbsm" (11, 46)
] "]" (11, 54)
; ";" (11, 55)
ID "NIX_CFLAGS_COMPILE" (15, 3)
= "=" (15, 22)
[ "[" (15, 24)
" "\"" (15, 26)
STR "-DDAEMON_UID=1" (15, 27)
" "\"" (15, 41)
" "\"" (16, 26)
STR "-DDAEMON_GID=1" (16, 27)
" "\"" (16, 41)
" "\"" (17, 26)
STR "-DDEFAULT_AT_QUEUE='a'" (17, 27)
" "\"" (17, 49)
" "\"" (18, 26)
STR "-DDEFAULT_BATCH_QUEUE='b'" (18, 27)
" "\"" (18, 52)
" "\"" (19, 26)
STR "-DPERM_PATH=\"/usr/lib/cron/\"" (19, 27)
" "\"" (19, 57)
" "\"" (20, 26)
STR "-DOPEN_DIRECTORY" (20, 27)
" "\"" (20, 43)
" "\"" (21, 26)
STR "-DNO_DIRECT_RPC" (21, 27)
" "\"" (21, 42)
" "\"" (22, 26)
STR "-DAPPLE_GETCONF_UNDERSCORE" (22, 27)
" "\"" (22, 53)
" "\"" (23, 26)
STR "-DAPPLE_GETCONF_SPEC" (23, 27)
" "\"" (23, 47)
" "\"" (24, 26)
STR "-DUSE_PAM" (24, 27)
" "\"" (24, 36)
" "\"" (25, 26)
STR "-DUSE_BSM_AUDIT" (25, 27)
" "\"" (25, 42)
" "\"" (26, 26)
STR "-D_PW_NAME_LEN=MAXLOGNAME" (26, 27)
" "\"" (26, 52)
" "\"" (27, 26)
STR "-D_PW_YPTOKEN=\"__YP!\"" (27, 27)
" "\"" (27, 50)
" "\"" (28, 26)
STR "-DAHZV1=64 " (28, 27)
" "\"" (28, 38)
" "\"" (29, 26)
STR "-DAU_SESSION_FLAG_HAS_TTY=0x4000" (29, 27)
" "\"" (29, 59)
" "\"" (30, 26)
STR "-DAU_SESSION_FLAG_HAS_AUTHENTICATED=0x4000" (30, 27)
" "\"" (30, 69)
] "]" (31, 24)
CONCAT "++" (31, 26)
ID "lib" (31, 29)
. "." (31, 32)
ID "optional" (31, 33)
( "(" (31, 42)
! "!" (31, 43)
ID "stdenv" (31, 44)
. "." (31, 50)
ID "isLinux" (31, 51)
) ")" (31, 58)
" "\"" (31, 60)
STR " -D__FreeBSD__ " (31, 61)
" "\"" (31, 76)
; ";" (31, 77)
ID "patchPhase" (33, 3)
= "=" (33, 14)
IND_STRING_OPEN "''\n" (33, 16)
IND_STR "    substituteInPlace login.tproj/login.c \\\n      --replace bsm/audit_session.h bsm/audit.h\n    substituteInPlace login.tproj/login_audit.c \\\n      --replace bsm/audit_session.h bsm/audit.h\n  " (34, 1)
IND_STRING_CLOSE "''" (38, 3)
+ "+" (38, 6)
ID "lib" (38, 8)
. "." (38, 11)
ID "optionalString" (38, 12)
ID "stdenv" (38, 27)
. "." (38, 33)
ID "isAarch64" (38, 34)
IND_STRING_OPEN "''\n" (38, 44)
IND_STR "    substituteInPlace sysctl.tproj/sysctl.c \\\n      --replace \"GPROF_STATE\" \"0\"\n    substituteInPlace login.tproj/login.c \\\n      --replace \"defined(__arm__)\" \"defined(__arm__) || defined(__arm64__)\"\n  " (39, 1)
IND_STRING_CLOSE "''" (43, 3)
; ";" (43, 5)
ID "buildPhase" (45, 3)
= "=" (45, 14)
IND_STRING_OPEN "''\n" (45, 16)
IND_STR "    for dir in *.tproj; do\n      name=$(basename $dir)\n      name=" (46, 1)
IND_STR "$" (48, 12)
IND_STR "{name%.tproj}\n\n      CFLAGS=\"\"\n      case $name in\n           arch) CFLAGS=\"-framework CoreFoundation\";;\n           atrun) CFLAGS=\"-Iat.tproj\";;\n           chkpasswd)\n             CFLAGS=\"-framework OpenDirectory -framework CoreFoundation -lpam\";;\n           getconf)\n               for f in getconf.tproj/*.gperf; do\n                   cfile=" (48, 15)
IND_STR "$" (58, 26)
IND_STR "{f%.gperf}.c\n                   LC_ALL=C awk -f getconf.tproj/fake-gperf.awk $f > $cfile\n               done\n           ;;\n           iostat) CFLAGS=\"-framework IOKit -framework CoreFoundation\";;\n           login) CFLAGS=\"-lbsm -lpam\";;\n           nvram) CFLAGS=\"-framework CoreFoundation -framework IOKit\";;\n           sadc) CFLAGS=\"-framework IOKit -framework CoreFoundation\";;\n           sar) CFLAGS=\"-Isadc.tproj\";;\n      esac\n\n      echo \"Building $name\"\n\n      case $name in\n\n           # These are all broken currently.\n           arch) continue;;\n           chpass) continue;;\n           dirhelper) continue;;\n           dynamic_pager) continue;;\n           fs_usage) continue;;\n           latency) continue;;\n           pagesize) continue;;\n           passwd) continue;;\n           reboot) continue;;\n           sc_usage) continue;;\n           shutdown) continue;;\n           trace) continue;;\n\n           *) cc $dir/*.c -I" (58, 29)
IND_STR "$" (87, 29)
IND_STR "{dir} $CFLAGS -o $name ;;\n      esac\n    done\n  " (87, 32)
IND_STRING_CLOSE "''" (90, 3)
; ";" (90, 5)
ID "installPhase" (92, 3)
= "=" (92, 16)
IND_STRING_OPEN "''\n" (92, 18)
IND_STR "    for dir in *.tproj; do\n      name=$(basename $dir)\n      name=" (93, 1)
IND_STR "$" (95, 12)
IND_STR "{name%.tproj}\n      [ -x $name ] && install -D $name $out/bin/$name\n      for n in 1 2 3 4 5 6 7 8 9; do\n        for f in $dir/*.$n; do\n          install -D $f $out/share/man/man$n/$(basename $f)\n        done\n      done\n    done\n  " (95, 15)
IND_STRING_CLOSE "''" (103, 3)
; ";" (103, 5)
ID "meta" (105, 3)
= "=" (105, 8)
{ "{" (105, 10)
ID "platforms" (106, 5)
= "=" (106, 15)
ID "lib" (106, 17)
. "." (106, 20)
ID "platforms" (106, 21)
. "." (106, 30)
ID "darwin" (106, 31)
; ";" (106, 37)
ID "maintainers" (107, 5)
= "=" (107, 17)
WITH "with" (107, 19)
ID "lib" (107, 24)
. "." (107, 27)
ID "maintainers" (107, 28)
; ";" (107, 39)
[ "[" (107, 41)
ID "shlevy" (107, 43)
ID "matthewbauer" (107, 50)
] "]" (107, 63)
; ";" (107, 64)
} "}" (108, 3)
; ";" (108, 4)
} "}" (109, 1)